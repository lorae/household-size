---
title: "Test title"
output: 
  html_document:
    mathjax: "default"
---



```{r init, include = FALSE}
library(ggplot2)
library(patchwork)
```

As shown in the documentation for this project, it is possible to have the same summary statistics but different underlying household configurations.

# Definitions and Notation

Let:

- \(P\) = **Total population size**
- \(H\) = **Number of households** 
- \(M_p\) = **Person-level mean household size**

    For every person \( j \) in a population \( P \) living in a household of \( m_j \) members, the **person-level** mean household size is a simple average across person-level observations:
    
    \begin{equation}
    \label{eq:1}
    \tag{1}
    M_p = \frac{\sum_{j = 1}^P m_j}{P}
    \end{equation}

- \(M_h\) = **Household-level mean household size**

   The **household-level** mean household size is a simple average across households as individual observations:
    
    \begin{align}
    \label{eq:2}
    \tag{2}
    M_h = \frac{P}{H}
    \end{align}

---

# Context

Equation \eqref{eq:2} shows that household-level mean household size and population is adequate to deduce the number of households. However, person-level household size does not lend itself to this equivalency: the same person-level mean and population can be consistent with multiple values for the number of households. 

Figure 1.2 illustrates this point in a hypothetical population with \( P = 6 \) and \( M_p = 3 \). In Scenario 1, average person-level household size is \( \frac{3+3+3 + 3+3+3}{6} = 3 \) and there are 2 households. In Scenario 2, average person-level household size is \( \frac{1 + 1 + 4+4+4+4}{6} = 3 \) and there are 3 households. Thus, population and person-level household size alone do not singularly determine the number of households.

**Figure 1.2**

```{r fig01.2, echo=FALSE, out.width="100%"}
# Data for Scenario 1
hh_data1 <- data.frame(
  hh_id = rep(c("Household A", "Household B"), times = c(3, 3)),
  x = c(1, 2, 1.5, 1, 2, 1.5),
  y = c(1, 1, 2, 1, 1, 2)
)

# Data for Scenario 2
hh_data2 <- data.frame(
  hh_id = rep(c("Household A", "Household B", "Household C"), times = c(1, 1, 4)),
  x = c(1.5, 1.5, 1, 1, 2, 2),
  y = c(1.5, 1.5, 1, 2, 1, 2)
)

# Plot for Scenario 1
plot1 <- ggplot(hh_data1, aes(x = x, y = y)) +
  geom_point(shape = 21, size = 4, color = "black", stroke = 1.2) +
  theme_void() +
  theme(
    plot.margin = margin(1, 1, 1, 1),
    plot.background = element_rect(color = "black", fill = NA, linewidth = 0.5)
  ) +
  facet_wrap(~hh_id, nrow = 1) +
  coord_fixed(ratio = 1) +
  xlim(0, 3) +
  ylim(0, 3) +
  ggtitle("Scenario 1")

# Plot for Scenario 2
plot2 <- ggplot(hh_data2, aes(x = x, y = y)) +
  geom_point(shape = 21, size = 4, color = "black", stroke = 1.2) +
  theme_void() +
  theme(
    plot.margin = margin(1, 1, 1, 1),
    plot.background = element_rect(color = "black", fill = NA, linewidth = 0.5)
  ) +
  facet_wrap(~hh_id, nrow = 1) +
  coord_fixed(ratio = 1) +
  xlim(0, 3) +
  ylim(0, 3) +
  ggtitle("Scenario 2")
```

```{r, fig.height=3, out.width="100%", echo = FALSE}
# Combine plots using patchwork
combined_plot <- plot1 + plot2 +
  plot_layout(widths = c(1, 1)) +
  plot_annotation(
    caption = expression(paste("Circles represent individual people. In both scenarios, P = 6 and ", M[p], " = 3, yet the number of households differs."))
  )

# Display the plot
print(combined_plot)

```

---

# Assertion

There is a range of possible number of households \(H\) consistent with a known population size \(P\) and person-level average household size \(M_p\). The range on \(H\) is bounded by a minumum of 

\begin{align}
H_{min} = \frac{P}{M_p}
\end{align}

and a maximum of

[FILL IN HERE]

---

# Lemma 1: Minimum Number of Households  

The minimum number of households consistent with a population size \(P\) and person-level average household size \(M_p\) is:
\begin{align}
H_{\min} = \frac{P}{M_p}
\end{align}

## Proof

Let the measured population $P$ of an area be $p$ and the measured person-level mean household size $M_p$ be $m$. Let $i$ be defined $i = p/m$

There are two possibilites:

- $i$ is an integer
- $i$ is not an integer

We diescuss each case in turn.

**$i$ is an integer**

If $m$ divides evenly into $p$, then one potential configuration of the population is to have $i$ households, each with exactly $\frac{p}{i} = m$ members.

[schematic showing this in an example where P = 30, m = 3].

We aim to prove that there is no possible configuration that can be achieved with $P = p$ and $M_p = m$ such that $H < i$.

Suppose we have the households in this configuration. The only way to reduce the number of households is to dissolve one household and distribute its members among the other households. In the current configuration,

\begin{equation}
M_{p, init} = \frac{\sum_{j = 1}^P m_j}{P} = \frac{im^2}{P} = m
\end{equation}

If we were to dissolve a household and put each of its members into one of $m$ other households (assuming that there are enough other households to do this), then

\begin{equation}
M_{p, post} = \frac{\sum_{j = 1}^P m_j}{P} = \frac{(i - 1 - m)m^2 + m(m+1)^2}{P} = \frac{m^2 + im^2 + m}{P}
\end{equation}

Since $m$ and $i$ are both positive integers, $M_{p, post} > M_{p, init}$

What if we instead dissolved a household and incorporated all $m$ of its members into one other household? Then

\begin{equation}
M_{p, post2} = \frac{\sum_{j = 1}^P m_j}{P} = \frac{(i - 2)m^2 + 1(2m)^2}{P} = \frac{im^2 + 2m^2}{P}
\end{equation}

Which is still larger than $M_{p, init}$. In fact, regardless of the way we reallocate the dissolved household to other households
...

this section of the proof ends where I show that there's no possible way to "dissolve" a household and add its contents to other households without pushing the average persn-level household size above $m$.

Case B:
Then I illustrate the same concept even when $i$ is not an integer by creating the "closest square household configuration" where I essentially show that, for example, if m = 2.75, you can configure the population into groups of the nearest integer-size households (2- and 3-person housholds) such that dissolving the contents of any one household and adding it to other households ill push the average person-level household size above $m$.

Thus, the configurations described above give the minimum number of households, $i = p/m$. And, in fact, when $i$ is not an integer, as in Case B, then the true minimum is given by rounding $i$ up to the nearest integer.

---

# Lemma 2: Maximum Number of Households  
**Lemma:**  
The maximum number of households consistent with a population size \(P\) and person-level average household size \(M_p\) is:
\begin{align}
TBD
\end{align}

**Proof:**  
In this section, I show that the sparsest configuraiton of households is given in a case where you produce some number of 1-person households and then throw the rest of the population into a remaining large households.

---
# conclusion

Reiterate the minima and maxima, take it back to the example at the begining and show that the two configurations I listed are actually the two special cases of minima and maxima.
